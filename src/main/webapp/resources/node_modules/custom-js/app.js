var app = angular.module('myApp', ['ngRoute', 'ngStorage']).run(['$rootScope', function ($rootScope) {
    $rootScope.appName = "inventory System Limited";

}]);


var url = "http://localhost:8080/";
app.config(['$routeProvider', function ($routeProvider) {
    $routeProvider.
        when('/changePassword', {
            templateUrl: '/resources/pages/changePassword.html',
            controller: 'changePasswordController'
        }).
        when('/other', {
            templateUrl: '/resources/pages/home.html'
        }).
        when('/createUser', {
            templateUrl: '/resources/pages/addUser.html',
            controller: 'userController'
        }).
        when('/updateUser', {
            templateUrl: '/resources/pages/updateUser.html',
            controller: 'updateUserController'
        }).
        when('/createCustomer', {
            templateUrl: '/resources/pages/addCustomer.html',
            controller: 'createCustomerController'
        }).
        otherwise({
            redirectTo: '/other'
        });

}]);


// create my own $filter(name)
//custom filter for filtering data based on uppercase and lower case

//custom service need to register to module
//filter call back function return another function
//callback function mandatory arugs is item where it call  like ng-repeat it arugs is array otherwhere object


//app.filter('myFilter', function() {
//    return function(x, firstObj, secondObj) {
//        // console.log(x);
//        var newObj = {
//            name: "",
//            country: ""
//        };
//        var i, c, txt = '';
//        var obj = [];
//        var t;
//        for (i = 0; i < x.length; i++) {
//            c = x[i];
//            // console.log(typeof firstObj ==='string');
//            newObj.country = c.country.toUpperCase();
//            if (typeof firstObj === 'string') {
//                if (firstObj === 'lowerCase') {
//                    newObj.name = c.name.toLowerCase();
//                } else if (firstObj === 'upeerCase') {
//                    newObj.name = c.name.toUpperCase();
//                } else {
//                    newObj.name = c.name;
//                }
//            }
//            if (typeof secondObj === 'string') {
//                if (secondObj === 'lowerCase') {
//                    newObj.country = c.country.toLowerCase();
//                } else if (secondObj === 'upeerCase') {
//                    newObj.country = c.country.toUpperCase();
//                } else {
//                    newObj.country = c.country;
//                }
//            }
//            c.name = newObj.name;
//            c.country = newObj.country;
//            // obj.push(newObj);
//        }
//        // console.log(x);
//        // x=obj;
//
//        return x;
//    };
//
//});


app.provider('userInfo', function () {
    var mainUrl;
    this.setting = function (base) {
        mainUrl = base.url;
    };

    var obj = {};


    this.$get = ['$http', '$log', function ($http, $log) {


        //user save service
        obj.userSave = function (success, error, scope) {
            var res = $http.post('user/save', scope);
            res.success(function (resp) {
                success(resp);
            });
            res.error(function (data, status, headers, config) {
                error(status);
            });
        };

        ///change Password service

        obj.updatePassword = function (success, error, scope) {
            var res = $http.post('user/changePassword', {
                'userName': scope.userName,
                'oldPassword': scope.oldPassword,
                'newPassword': scope.newPassword
            });
            res.success(function (resp) {
                success(resp);
            });
            res.error(function (data, status, headers, config) {
                error(status);
            });
        };


        //load list of user info

        //obj.userList = function (success, error, scope) {
        //    var res = $http.post('user/userList',scope);
        //    res.success(function (resp) {
        //        success(resp);
        //    });
        //    res.error(function (data, status, headers, config) {
        //        error(status);
        //    });
        //};


        obj.userList = function (success, error, scope) {
            var res = $http.post('user/userList',scope);
            res.then(res.success(function (resp) {
                success(resp);
            }),
            res.error(function (data, status, headers, config) {
                error(status);
            }));

        };


        //updateUser


        //user save service
        obj.updateUser = function (success, error, scope) {
            var res = $http.post('user/update', scope);
            res.success(function (resp) {
                success(resp);
            });
            res.error(function (data, status, headers, config) {
                error(status);
            });
        };



        //Delete User


        obj.deleteUser = function (success, error, scope) {
            var res = $http.post('user/delete', scope.id);
            res.success(function (resp) {
                success(resp);
            });
            res.error(function (data, status, headers, config) {
                error(status);
            });
        };



        //Customer save service
        obj.customerSave = function (success, error, scope) {
            var res = $http.post('customer/save', scope);
            res.success(function (resp) {
                success(resp);
            });
            res.error(function (data, status, headers, config) {
                error(status);
            });
        };

        return obj;
    }];

});


//register provider
app.config(['userInfoProvider', function (userInfoProvider) {
    userInfoProvider.setting({url: "http://localhost:8080/"});

}])


// user details get service
app.service('userDetails', ['$http', '$log', function ($http, $log) {


    this.principal = function (x) {
        $http({
            url: url + 'user/principle',
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(function (resp) {
            x(resp);
        }, function (err) {
            $log.log('not get proper data');
        });
    };

}]);


//service for controller inner communication
app.factory('userMessageService', function () {
    return {
        changePasswordSuccessMsg: "Password change successfully",
        email: "",
        id: "",
        version: ""
    }
});


// 2nd module for user login
var appLogin = angular.module('loginApp', ['myApp']);
